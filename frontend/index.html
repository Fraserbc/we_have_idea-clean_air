<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>

    <style>
                #map {
                        width: 98vw;
                        height: 96vh;
                        float: right;
                }
    </style>


</head>

<body>
    <form id="postcodeform" action="#" onsubmit="onLocationFound(document.getElementById('postcodebox').value);"><input id="postcodebox" type="text" placeholder="Postcode" name="postcode" style="float: left; width: 70vw;  margin: 0"><input id="submitbutton" type="submit" value="Go" style="float: right; width: 19vw; padding-top: 0.5vh; margin-right: 0.75vw"></form>

<div id="map"></div>

    <script>
        var map = L.map('map').fitWorld();

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                        '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                        'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                id: 'mapbox.streets'
        }).addTo(map);

        function onLocationFound(postcode) {
                var elem = document.getElementById('submitbutton');
                elem.value = "Get results"
                elem.onclick = function() {return false;}

                var xhr = new XMLHttpRequest();
                xhr.open('GET', ('https://api.postcodes.io/postcodes/'+ document.getElementById('postcodebox').value), true);
                xhr.send();
                xhr.onreadystatechange = function (e) {
                	var geocoded = JSON.parse(xhr.responseText);
                	geocoded.latlng = new Object();
                	geocoded.latlng.lat = geocoded.result.latitude;
                	geocoded.latlng.lng = geocoded.result.longitude;
                	map.flyTo([geocoded.latlng.lat, geocoded.latlng.lat], 13);
					//map.panTo([geocoded.latlng.lat, geocoded.latlng.lat], 13);
                	L.marker(geocoded.latlng).addTo(map).bindPopup("You are here").openPopup();
                	L.circle(geocoded.latlng, 1).addTo(map);
                }
        }

        //map.locate({setView: true, maxZoom: 16});
    </script>



</body>

</html>
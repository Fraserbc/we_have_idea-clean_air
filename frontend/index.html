<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="">
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>

    <style>
                #map {
                        width: 98vw;
                        height: 96vh;
                        float: right;
                }
    </style>


</head>

<body>
    <form id="postcodeform" action="#" onsubmit="var xhr = new XMLHttpRequest(); xhr.open('GET', ('https://api.postcodes.io/postcodes/'+ document.getElementById('postcodebox').value), true); xhr.send(); xhr.onreadystatechange = function (e) {console.log(xhr.responseText); var geocoded = JSON.parse(xhr.responseText);}"><input id="postcodebox" type="text" placeholder="Postcode" name="postcode" style="float: left; width: 70vw;  margin: 0"><input id="submitbutton" type="submit" value="Go" style="float: right; width: 19vw; padding-top: 0.5vh; margin-right: 0.75vw"></form>

<div id="map"></div>

    <script>
        var map = L.map('map').fitWorld();

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                        '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                        'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                id: 'mapbox.streets'
        }).addTo(map);

        function onLocationFound(e) {
                var radius = e.accuracy / 2;
                
                var elem = document.getElementById('submitbutton');
                elem.value = "Get results"
                elem.onclick = 
                console.log(document.getElementById('submitbutton'));
               	var xhr = new XMLHttpRequest(); xhr.open('GET', ('https://api.postcodes.io/postcodes?lon=' + e.latitude.toString() + "&lat=" + e.longitude.toString())); xhr.send(); xhr.onreadystatechange = function (e) {console.log(xhr.responseText); var postcode = JSON.parse(xhr.responseText);}
                var elem = document.getElementById('postcodebox')
                elem.defaultvalue = postcode("postcode")

                L.marker(e.latlng).addTo(map)
                        .bindPopup("You are within " + radius + " meters from this point").openPopup();

                L.circle(e.latlng, radius).addTo(map);
        }

        function onLocationError(e) {
                alert(e.message + " Please input your postcode above or allow location");
        }

        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);

        map.locate({setView: true, maxZoom: 16});
    </script>



</body>

</html>
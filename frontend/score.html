<!DOCTYPE html>
<html>
<head>
	<title>Score</title>
	<link rel="stylesheet" type="text/css" href="score.css">
	<link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel="stylesheet">
</head>
<body onload="getScore();">

<div class="main-container">
	<div class="title">Air Quality Meter</div>
	<center>
		<canvas id="dial" width="512" height="512"></canvas>
		<div class="score-text">Your score is:<br>
			<span id="score-text">&nbsp;</span><br>
			<div id="score-msg">&nbsp;</div>
		</div>
	</center>
	<div class="asdf" id="asdf"></div>
</div>

<div class="offscreen"><img src="gradient.png" id="gradient"></div>

<script type="text/javascript">
	var urlParams = new URLSearchParams(window.location.search);

	const Http = new XMLHttpRequest();
	const url = window.location.href.split("/")[2];

	Http.open("POST", "http://" + url + "/api/score");

	function getScore() {
		Http.setRequestHeader("Content-Type", "application/json");
		var s = '{"lat": ' + urlParams.get('lat').toString() + ', "lon": ' + urlParams.get('lng').toString() + '}';
		Http.send(s);
	}

	Http.onreadystatechange = function() {
		var j = JSON.parse(Http.responseText);
		drawDial(j.score,  512);
		document.getElementById("score-text").innerHTML = j.score.toString();
		document.getElementById("score-msg").innerHTML = j.message;
		var a = j.abilities;
		document.getElementById("asdf").innerHTML = "<ul>";
		for (var i=0; i<a.length; i++) {
			document.getElementById("asdf").innerHTML += "<li>" + a[i] + "</li>";
		}
		document.getElementById("asdf").innerHTML += "<ul>";
	}
</script>
<script src="dial.js"></script>

</body>
</html>
